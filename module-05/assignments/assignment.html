<html>
    <head>
        <title>Module 5 Assignment</title>
        <link rel="stylesheet" href="./style.css">
    </head>
    <body>
        <h1>Customers List : </h1>
        <table id="data" border="1">
            <tr>
                <th>Name</th>
                <th>Address</th>
                <th>Phone no.</th>
                <th>Email</th>
                <th>Orders</th>
            </tr>
        </table>
        <script>
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function (){
                if(this.readyState == 4 && this.status == 200){
                    displayData(this.responseXML);
                }
            };
            xhr.open("GET","customers.xml",true);
            xhr.send();

            function displayData(xmlDoc){
                const customers = xmlDoc.getElementsByTagName("customer");

                const list = document.getElementById(`data`);

                for(let index = 0; index < customers.length; index++){
                    const cust = customers[index];
                    const parsedCust = parseCust(cust);

                    const custElement = createCust(parsedCust);
                    list.appendChild(custElement);
                }
            }

            function parseCust(xml){
                const name = xml.getElementsByTagName(`name`)[0].childNodes[0].nodeValue;
                const address = xml.getElementsByTagName(`address`)[0].childNodes[0].nodeValue;
                const phone = xml.getElementsByTagName(`phone`)[0].childNodes[0].nodeValue;
                var email = "";
                if(xml.getElementsByTagName(`email`)[0] != null)
                    email = xml.getElementsByTagName(`email`)[0].childNodes[0].nodeValue;
                else
                    email = "Not given";
                const orderID = xml.getElementsByTagName(`order`)[0].getAttribute(`orderID`);
                const orderDate = xml.getElementsByTagName(`orderDate`)[0].childNodes[0].nodeValue;
                const itemprice = xml.getElementsByTagName(`itemPrice`)[0].childNodes[0].nodeValue;
                const itemqty = xml.getElementsByTagName(`itemQty`)[0].childNodes[0].nodeValue;

                return {name,address,phone,email,orderID,orderDate,itemprice,itemqty};
            }
            function stringToNode(html){
                const template = document.createElement("template");
                html = html.trim();
                template.innerHTML = html;
                return template.content.firstChild;
            }
            function createCust(cust){
                const content = 
                    `<tr>
                        <td><h2>Name: ${cust.name}</h2></td>
                        <td>Address: ${cust.address}</td>
                        <td>Phone: ${cust.phone}</td>
                        <td>e-mail: ${cust.email}</td>
                        <td>
                            <ul>
                                <li>Order ID: ${cust.orderID}</li>
                                <li>Order Date: ${cust.orderDate}</li>
                                <li>Item Price: ${cust.itemprice}</li>
                                <li>Item Quantity: ${cust.itemqty}</li>
                            </li>
                            </ul>
                        </td>
                    </tr>`;
                return stringToNode(content);
            }
        </script>

    </body>
</html>